# 窗口重排器 (Window Rearranger)

**窗口重排器** 是一个基于 Python (PySide6) 开发的 Windows 桌面工具。它允许用户指定一组窗口，并强制它们按照设定的顺序（Z-Order）进行排列。

该工具的核心功能是**自动监控**：当你点击被管理的窗口时，它会自动检测并重新应用你设定的层级顺序，确保辅助窗口或特定窗口始终保持在你期望的层级关系中（例如保持某个参考窗口紧跟在主工作窗口之后）。

## ✨ 功能特性

*   **窗口探测**：自动枚举当前系统中所有可见的真实窗口（过滤掉隐藏窗口、工具悬浮窗等）。
*   **可视化管理**：
    *   左侧列表显示当前活动窗口，支持实时刷新。
    *   右侧列表为“管理队列”，支持拖拽或按钮调整层级顺序。
    *   自动获取并显示窗口图标。
*   **智能重排引擎**：
    *   **手动执行**：点击“立即执行重排”按钮强制排序。
    *   **自动触发**：通过全局鼠标钩子（Mouse Hook），检测到用户点击了被管理的窗口时，自动触发重排。
    *   **最小化跳过**：自动跳过处于最小化状态的窗口，避免干扰用户操作。
*   **误触防范**：
    *   **关闭按钮检测**：智能识别窗口右上角（关闭按钮区域）的点击。如果用户试图关闭窗口，不会触发重排逻辑，从而避免操作冲突。
*   **现代化 UI**：使用 `qdarktheme` 提供深色模式界面，体验舒适。

## 🛠️ 技术栈

*   **GUI 框架**: [PySide6](https://pypi.org/project/PySide6/) (Qt for Python)
*   **Windows API**: [pywin32](https://pypi.org/project/pywin32/) (win32gui, win32con), `ctypes`
*   **输入监听**: [pynput](https://pypi.org/project/pynput/) (用于鼠标全局钩子)
*   **主题美化**: [pyqtdarktheme](https://pypi.org/project/pyqtdarktheme/)

## 📦 安装与运行

### 1. 环境要求
*   Windows 10/11 操作系统
*   Python 3.10

### 2. 安装依赖
在项目根目录下，运行以下命令安装所需的 Python 库：

```bash
pip install requirements.txt
```

### 3. 运行程序
运行 `main.py` 启动应用程序：

```bash
python main.py
```

## 📖 使用指南

1.  **选择窗口**：
    *   程序启动后，左侧列表会显示当前打开的窗口。
    *   **双击**左侧列表中的窗口，将其添加到右侧的“排序层级”列表中。

2.  **调整顺序**：
    *   在右侧列表中，选中某个窗口。
    *   点击 **“▲ 上移”** 或 **“▼ 下移”** 按钮调整其在 Z 轴上的顺序。
    *   *注意：列表越靠上的窗口，在屏幕显示时层级越高（越靠前）。*

3.  **应用重排**：
    *   点击 **“立即执行重排”** 按钮，程序会立即按照列表顺序调整窗口层叠关系。
    *   或者，直接点击屏幕上任意一个已被管理的窗口，程序会自动检测并执行重排。

4.  **移除管理**：
    *   **双击**右侧列表中的窗口，即可将其从管理队列中移除。

## 📂 项目结构

```text
.
├── main.py             # 程序入口，主窗口逻辑，信号槽绑定
├── ui_widgets.py       # 自定义 UI 控件（左侧/右侧列表项的渲染）
├── rank_engine.py      # 核心逻辑：管理目标窗口列表、执行 Z-Order 重排
├── auto_monitor.py     # 监控模块：使用 pynput 监听鼠标点击，触发重排
├── win_api.py          # 底层模块：封装 Windows API (获取窗口、图标、判断位置等)
├── logger.py           # 日志模块：配置日志输出到控制台和 logs/ 文件夹
└── logs/               # 运行时产生的日志文件
```

## ⚠️ 注意事项
*   **关闭按钮判定**：程序通过硬编码逻辑判断窗口右上角 `60x40` 像素区域为关闭按钮区域。对于非标准标题栏的自绘窗口，此判断可能存在偏差。
*   **日志**：程序会在 `logs/` 目录下生成 `window_list.log`，如果遇到问题，可以查看日志进行排查。

## 📝 License

本项目仅供个人学习和练习使用。